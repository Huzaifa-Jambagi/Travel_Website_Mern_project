<% layout("layouts/boilerplate.ejs") %>

    <div class="row mt-3">
        <div class="col-8 offset-2">
            <h2 class="text-start">
                <%= listing.title %>
            </h2>
        </div>

        <div class="card col-8 offset-2 show-card " style="height: 35rem; border: none;"> <!-- Adjusted card height -->
            <div style="height: 19rem; overflow: hidden;">
                <img src="<%= listing.image.url %>" class="card-img-top show-img" alt="listing_image"
                    style="height: 100%; object-fit: cover; width: 100%;">
            </div>
            <div class="card-body text-start">
                <p class="card-text">
                  <i>by  <%=listing.owner[0].name%></i>  
                    <br>
                    <%= listing.description %>
                        <br><br>
                        <strong>Price:</strong> &#8377; <%= listing.price.toLocaleString("en-IN") %>
                        <br><br>
                        <strong>Location:</strong>
                        <%= listing.location %>
                            <br><strong>Country:</strong>
                            <%= listing.country %>
                </p>
              <% if(user && user._id.equals(listing.owner[0]._id)) {%>
                <div class="d-flex justify-content-start mt-3">
                    <button class="btn btn-danger me-2">
                        <a style="text-decoration: none; color: white;" href="/listings/<%= listing._id %>/edit"
                            role="button">Edit</a>
                    </button>

                    <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
                        <button class="btn btn-danger">Delete</button>
                    </form>

                </div>
                <% } %>
            </div>
        </div>
    </div>
    <hr>
   <%if(user){%>
    <div class="col-8 offset-2">
        <h4>Leave a review</h4>
        <form method="POST" action="/listings/<%=listing._id %>/reviews" novalidate class="needs-validation">
            <div class="rating">
                <input type="radio" name="rating" value="5" id="star5" />
                <label class="star" for="star5" title="5 stars">★</label>

                <input type="radio" name="rating" value="4" id="star4" />
                <label class="star" for="star4" title="4 stars">★</label>

                <input type="radio" name="rating" value="3" id="star3" />
                <label class="star" for="star3" title="3 stars">★</label>

                <input type="radio" name="rating" value="2" id="star2" />
                <label class="star" for="star2" title="2 stars">★</label>

                <input type="radio" name="rating" value="1" id="star1" />
                <label class="star" for="star1" title="1 star">★</label>
            </div>
            <br>
            <div class="">
                <!-- <label for="review" class="form-label">Review</label>
        <br> -->
                <textarea cols="30" rows="5" name="comment" placeholder="How was your experience in this place?"
                    class="form-control" required></textarea>
                <div class="invalid-feedback">Please add comments for review</div>
            </div>
            <br>
            <div class="">
                <button class="btn btn-outline-dark">Submit</button>
            </div>
        </form>
    </div>
    <hr>
    <%}%>
    <h4 class="offset-2"">All Reviews</h4>
    <div class="row">
            <% for (let review of listing.reviews) { %>
                
                    <div class="card col-5 ms-3 mb-3 me-2">
                        <div class="card-body">
                        <!-- Render stars based on the review rating -->
                         <br>
                         <h5 class="card-title">@<%= review.author[0].username %></h5>
                        <% for (let i = 1; i <= 5; i++) { %>
                            <span class="star <%= i <= review.rating ? 'gold' : 'gray' %>">★</span>
                        <% } %>
                        <br>
                        <span class="card-text"><%= review.review %></span>
                        <br><br>
                        <% if (user && user._id.equals(review.author[0]._id)) { %>
                            <form method="POST" class="mb-3" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE">
                              <button class="btn btn-sm btn-dark">Delete</button>
                            </form>
                          <% } %>
                          
                    </div>
                </div>
                <br>
            <% } %>
        </div>
    <br><br>
    <script src="/js/script.js"></script>